# bazi_report_generator.py

<<<<<<< HEAD
import httpx # Using httpx for HTTP requests, you can use 'requests' as well
import json
from typing import Dict

# You might have a more sophisticated Bazi calculation utility.
# For now, calculate_simple_bazi is a placeholder.
# If you have a real Bazi library (like sxtwlpy or a custom one), integrate it here.
TIAN_GAN = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"]
DI_ZHI = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"]

# Simplified Bazi calculation - placeholder, replace with accurate logic
def get_gan_zhi(year, val_offset_gan, val_offset_zhi):
    # This is an extremely naive placeholder and not astrologically correct.
    # Replace with a proper Bazi calculation library or algorithm.
    gan_idx = (year - val_offset_gan) % 10
    zhi_idx = (year - val_offset_zhi) % 12
    return f"{TIAN_GAN[gan_idx]}{DI_ZHI[zhi_idx]}"

class DeepSeekBaziReport:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = "https://api.deepseek.com/v1" # Official API endpoint

    def _call_deepseek_api(self, prompt: str, model: str = "deepseek-chat", temperature: float = 0.7) -> str:
=======
import requests
import json
from datetime import datetime
import sxtwl

class DeepSeekBaziReport:
    def __init__(self, api_key):
        self.api_key = api_key
        self.base_url = "https://api.deepseek.com/v1/chat/completions"
        
        # å…«å­—åŸºç¡€æ•°æ®ï¼ˆç”¨äºŽæœ¬åœ°è®¡ç®—ï¼‰
        self.Gan = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"]
        self.Zhi = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"]

        # äº”è¡Œæ˜ å°„ (è¿™äº›æ˜ å°„ä¿¡æ¯å¯ä»¥ä¿ç•™ï¼Œå› ä¸ºAIå¯èƒ½éœ€è¦å®ƒä»¬è¿›è¡Œåˆ†æžï¼Œå³ä½¿æˆ‘ä»¬ä¸æœ¬åœ°è®¡ç®—)
        self.gan_elements = {
            "ç”²": "æœ¨", "ä¹™": "æœ¨", "ä¸™": "ç«", "ä¸": "ç«", "æˆŠ": "åœŸ",
            "å·±": "åœŸ", "åºš": "é‡‘", "è¾›": "é‡‘", "å£¬": "æ°´", "ç™¸": "æ°´"
        }
        self.zhi_elements = {
            "å­": "æ°´", "ä¸‘": "åœŸ", "å¯…": "æœ¨", "å¯": "æœ¨", "è¾°": "åœŸ",
            "å·³": "ç«", "åˆ": "ç«", "æœª": "åœŸ", "ç”³": "é‡‘", "é…‰": "é‡‘",
            "æˆŒ": "åœŸ", "äº¥": "æ°´"
        }
        self.zhi_hidden_stems = {
            "å­": ["ç™¸"], "ä¸‘": ["å·±", "ç™¸", "è¾›"], "å¯…": ["ç”²", "ä¸™", "æˆŠ"],
            "å¯": ["ä¹™"], "è¾°": ["æˆŠ", "ä¹™", "ç™¸"], "å·³": ["ä¸™", "åºš", "æˆŠ"],
            "åˆ": ["ä¸", "å·±"], "æœª": ["å·±", "ä¸", "ä¹™"], "ç”³": ["åºš", "å£¬", "æˆŠ"],
            "é…‰": ["è¾›"], "æˆŒ": ["æˆŠ", "è¾›", "ä¸"], "äº¥": ["å£¬", "ç”²"]
        }


    def calculate_simple_bazi(self, year, month, day, hour):
        """
        æ ¹æ®å…¬åŽ†æ—¥æœŸå’Œæ—¶è¾°è®¡ç®—å››æŸ±å…«å­—ã€‚
        Args:
            year (int): å…¬åŽ†å¹´ä»½
            month (int): å…¬åŽ†æœˆä»½
            day (int): å…¬åŽ†æ—¥æœŸ
            hour (int): å…¬åŽ†å°æ—¶ (0-23)ï¼Œç”¨äºŽè®¡ç®—æ—¶æŸ±
        Returns:
            dict: åŒ…å«å››æŸ±å¹²æ”¯çš„å­—å…¸
        """
        try:
            day_obj = sxtwl.fromSolar(year, month, day) 

            yTG = day_obj.getYearGZ()
            mTG = day_obj.getMonthGZ()
            dTG = day_obj.getDayGZ()
            sTG = day_obj.getHourGZ(hour)
            
            bazi_info = {
                "year_gz": self.Gan[yTG.tg] + self.Zhi[yTG.dz],
                "month_gz": self.Gan[mTG.tg] + self.Zhi[mTG.dz],
                "day_gz": self.Gan[dTG.tg] + self.Zhi[dTG.dz],
                "hour_gz": self.Gan[sTG.tg] + self.Zhi[sTG.dz]
            }
            return bazi_info
        except Exception as e:
            raise ValueError(f"å…«å­—è®¡ç®—å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥æœŸå’Œæ—¶é—´è¾“å…¥: {e}")

    # ç§»é™¤äº† calculate_five_element_balance æ–¹æ³•ï¼Œå› ä¸ºä¸å†ç”¨äºŽå‰ç«¯ç»˜å›¾ã€‚

    def call_deepseek_api(self, prompt, max_tokens=5000, model="deepseek-chat"):
        """è°ƒç”¨ DeepSeek API ç”Ÿæˆå†…å®¹"""
>>>>>>> 936059c1e5039781dfa58c2493bc95dd7ca44050
        headers = {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json"
        }
<<<<<<< HEAD
        data = {
            "model": model,
            "messages": [
                {"role": "system", "content": "ä½ æ˜¯ä¸€ä½ç²¾é€šä¸­åŽä¼ ç»Ÿå…«å­—å‘½ç†å­¦çš„èµ„æ·±ä¸“å®¶ã€‚åœ¨ç”ŸæˆæŠ¥å‘Šæ—¶ï¼Œè¯·å§‹ç»ˆé‡‡ç”¨å¨“å¨“é“æ¥çš„å™è¿°é£Žæ ¼ï¼Œç¡®ä¿è¯­è¨€æµç•…è‡ªç„¶ï¼Œå¯Œæœ‰äº²å’ŒåŠ›ã€‚å¯¹äºŽæ¯ä¸€ä¸ªåˆ†æžè¦ç‚¹ï¼Œéƒ½è¯·ç”¨3åˆ°5å¥å®Œæ•´ä¸”è¿žè´¯çš„å¥å­ç»„æˆä¸€ä¸ªå°æ®µè½è¿›è¡Œæ·±å…¥æµ…å‡ºçš„é˜é‡Šï¼Œè®©ä¸äº†è§£å…«å­—çš„ç”¨æˆ·ä¹Ÿèƒ½è½»æ¾ç†è§£ã€‚è¯·ä½¿ç”¨Markdownæ ¼å¼åŒ–è¾“å‡ºï¼Œä¿æŒæŠ¥å‘Šçš„ä¸“ä¸šæ€§å’Œç»“æž„æ¸…æ™°ã€‚"},
                {"role": "user", "content": prompt}
            ],
            "temperature": temperature,
            "max_tokens": 4000, # Adjust as needed
        }
        try:
            with httpx.Client(timeout=180.0) as client: # Increased timeout
                response = client.post(f"{self.base_url}/chat/completions", headers=headers, json=data)
                response.raise_for_status()
            result = response.json()
            if 'choices' in result and len(result['choices']) > 0:
                content = result['choices'][0]['message']['content'].strip()
                # Remove potential ```markdown ... ``` wrappers if LLM adds them
                if content.startswith("```markdown\n"):
                    content = content[len("```markdown\n"):]
                if content.startswith("```\n"):
                    content = content[len("```\n"):]
                if content.endswith("\n```"):
                    content = content[:-len("\n```")]
                return content
            else:
                return f"API Error: Unexpected response format - {json.dumps(result)}"
        except httpx.HTTPStatusError as e:
            error_details = e.response.text
            try:
                error_json = json.loads(error_details)
                error_message = error_json.get("error", {}).get("message", error_details)
            except json.JSONDecodeError:
                error_message = error_details
            return f"API Error: {e.response.status_code} - {error_message}"
        except Exception as e:
            return f"Error calling DeepSeek API: {str(e)}"

    def calculate_simple_bazi(self, year: int, month: int, day: int, hour: int) -> Dict[str, str]:
        # Placeholder: Replace with a robust Bazi calculation library (e.g., sxtwl, lunisolar)
        try:
            year_gz = get_gan_zhi(year, 4, 4) 
            month_gz = get_gan_zhi(month, 1, 1) 
            day_gz = get_gan_zhi(day, 1, 1) 
            hour_gz = get_gan_zhi(hour // 2, 1, 1) 

            return {
                "year_gz": year_gz,
                "month_gz": month_gz,
                "day_gz": day_gz,
                "hour_gz": hour_gz
            }
        except Exception as e:
            print(f"Error in placeholder Bazi calculation: {e}")
            return {
                "year_gz": "ç”²å­", "month_gz": "ä¸™å¯…",
                "day_gz": "ä¸å¯", "hour_gz": "æˆŠè¾°"
            }


    def generate_free_report(self, bazi_str: str, gender: str) -> str:
        prompt = f"""
            è¯·æ ¹æ®ä»¥ä¸‹å…«å­—ä¿¡æ¯å’Œæ€§åˆ«ï¼Œç”Ÿæˆä¸€ä»½ç®€è¦çš„å…è´¹å…«å­—å‘½ç†æŠ¥å‘Šã€‚æŠ¥å‘Šå†…å®¹åº”ç›´æŽ¥å‘ˆçŽ°ï¼Œæ— éœ€é¢å¤–è§£é‡Šæˆ–æ ‡é¢˜ã€‚

            å…«å­—ï¼š{bazi_str}
            æ€§åˆ«ï¼š{gender}

            æŠ¥å‘Šåº”åŒ…å«ä»¥ä¸‹å‡ ç‚¹ï¼Œæ¯ç‚¹ç”¨1-2å¥è¯æ¦‚æ‹¬ï¼š
            1.  **æ—¥ä¸»ç‰¹æ€§**: ç®€è¿°æ—¥ä¸»ï¼ˆæ—¥å¹²ï¼‰çš„åŸºæœ¬å±žæ€§å’Œç‰¹ç‚¹ã€‚
            2.  **æ€§æ ¼æ¦‚è¦**: æ ¹æ®å…«å­—ç»„åˆï¼Œæ¦‚æ‹¬ä¸»è¦çš„æ€§æ ¼ç‰¹å¾ã€‚
            3.  **è¿åŠ¿æé†’**: ç»™å‡ºä¸€æ¡è¿‘æœŸçš„æˆ–ç¬¼ç»Ÿçš„è¿åŠ¿æé†’ã€‚

            è¯·ç›´æŽ¥è¾“å‡ºè¿™ä»½åŒ…å«ä¸‰ç‚¹çš„ç®€è¦æŠ¥å‘Šã€‚
            """
        return self._call_deepseek_api(prompt, temperature=0.5)

    def generate_bazi_analysis_module(self, bazi_str: str, gender: str) -> str:
        prompt = f"""
            ### å…«å­—æŽ’ç›˜ä¸Žäº”è¡Œåˆ†æž

            é’ˆå¯¹å…«å­—ï¼š{bazi_str}ï¼Œæ€§åˆ«ï¼š{gender}ã€‚
            
            **é‡è¦æç¤ºï¼š** è¯·æ‚¨åœ¨æ’°å†™æ­¤æ¨¡å—æ—¶ï¼Œé‡‡ç”¨å¨“å¨“é“æ¥çš„å™è¿°é£Žæ ¼ã€‚å¯¹äºŽä»¥ä¸‹åˆ—å‡ºçš„æ¯ä¸€ä¸ªä¸»è¦åˆ†æžç‚¹ï¼ˆå¦‚â€œ1. å››æŸ±å¹²æ”¯â€ã€â€œ2. äº”è¡ŒåŠ›é‡åˆ†æžâ€ç­‰ï¼‰åŠå…¶å†…éƒ¨çš„å­é¡¹ï¼ˆè‹¥æœ‰ï¼‰ï¼Œè¯·ä¸è¦åªæ˜¯ç®€å•ç½—åˆ—ä¿¡æ¯ã€‚è€Œæ˜¯é’ˆå¯¹æ¯ä¸€é¡¹ï¼Œéƒ½ç”¨3åˆ°5å¥å®Œæ•´ä¸”è¿žè´¯çš„å¥å­ç»„æˆä¸€ä¸ªæµç•…çš„å°æ®µè½æ¥è¿›è¡Œæ·±å…¥æµ…å‡ºçš„é˜é‡Šã€‚æ‚¨çš„ç›®æ ‡æ˜¯è®©å³ä½¿ä¸ç†Ÿæ‚‰å…«å­—å‘½ç†çš„è¯»è€…ä¹Ÿèƒ½è½»æ¾ç†è§£å„é¡¹åˆ†æžçš„å«ä¹‰ã€é€»è¾‘åŠå…¶å¯¹å‘½ä¸»çš„å½±å“ã€‚è¯·ä¿æŒä¸“ä¸šçš„åˆ†æžæ·±åº¦ï¼ŒåŒæ—¶ç¡®ä¿è¯­è¨€é€šä¿—æ˜“æ‡‚ã€å¯Œæœ‰äº²å’ŒåŠ›ã€‚è¯·ç›´æŽ¥ä»¥è¿™æ ·çš„å™è¿°æ–¹å¼å¡«å……å„ä¸ªè¦ç‚¹ï¼Œå¹¶ä½¿ç”¨Markdownæ ¼å¼åŒ–æ‚¨çš„è¾“å‡ºï¼ŒåŒ…æ‹¬æ ‡é¢˜å’Œå¿…è¦çš„å¼ºè°ƒã€‚

            è¯·è¯¦ç»†åˆ†æžä»¥ä¸‹å†…å®¹ï¼š

            1.  **å››æŸ±å¹²æ”¯è§£è¯»**ï¼š
                *   å¹´æŸ±: [è¯·åœ¨æ­¤å¤„å¡«å†™å®žé™…å¹´æŸ±å¹²æ”¯]ï¼Œå¹¶ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œé˜è¿°å…¶åœ¨æ•´ä¸ªå‘½ç›˜ä¸­çš„åŸºç¡€æ„ä¹‰ï¼Œä¾‹å¦‚å®ƒé€šå¸¸ä»£è¡¨ç€å‘½ä¸»çš„ç¥–ä¸Šæ ¹åŸºã€æ—©å¹´è¿ç¨‹ï¼ˆé€šå¸¸æŒ‡16å²å‰ï¼‰ä»¥åŠæ—¶ä»£å¤§çŽ¯å¢ƒæ‰€èµ‹äºˆçš„åˆå§‹å°è®°ç­‰ã€‚
                *   æœˆæŸ±: [è¯·åœ¨æ­¤å¤„å¡«å†™å®žé™…æœˆæŸ±å¹²æ”¯]ï¼Œå¹¶ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œé˜è¿°å…¶å…³é”®ä½œç”¨ï¼Œä¾‹å¦‚å®ƒæ·±åˆ»å½±å“ç€å‘½ä¸»çš„å®¶åº­çŽ¯å¢ƒã€çˆ¶æ¯å…„å¼Ÿå§å¦¹çš„å…³ç³»ã€é’å°‘å¹´æ—¶æœŸçš„æˆé•¿ç»åŽ†ï¼ˆé€šå¸¸æŒ‡16-32å²ï¼‰ï¼ŒåŒæ—¶ä¹Ÿæ˜¯è§‚å¯Ÿä¸ªäººæ€§æ ¼å½¢æˆå’Œäº‹ä¸šå‘å±•æ½œåŠ›çš„é‡è¦çª—å£ã€‚
                *   æ—¥æŸ±: [è¯·åœ¨æ­¤å¤„å¡«å†™å®žé™…æ—¥æŸ±å¹²æ”¯] (å…¶ä¸­æ—¥å¹²æ˜¯ï¼š[æ—¥å¹²])ï¼Œå¹¶ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œè¯¦ç»†è¯´æ˜Žæ­¤æ—¥å¹²ä½œä¸ºå‘½ä¸»ï¼ˆä¹Ÿç§°æ—¥å…ƒæˆ–è‡ªèº«ï¼‰çš„æ ¸å¿ƒç‰¹è´¨ã€æœ¬æ€§ä»¥åŠå†…åœ¨é©±åŠ¨åŠ›ï¼ŒåŒæ—¶æ—¥æ”¯ï¼ˆä¹Ÿç§°å¤«å¦»å®«ï¼‰ä¹Ÿæ­ç¤ºäº†å‘½ä¸»ä¸­å¹´è¿åŠ¿ï¼ˆé€šå¸¸æŒ‡32-48å²ï¼‰ã€å©šå§»è§‚å¿µåŠä¸Žä¼´ä¾£äº’åŠ¨æ¨¡å¼çš„åˆæ­¥ä¿¡æ¯ã€‚
                *   æ—¶æŸ±: [è¯·åœ¨æ­¤å¤„å¡«å†™å®žé™…æ—¶æŸ±å¹²æ”¯]ï¼Œå¹¶ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œé˜è¿°å…¶æ‰€ä»£è¡¨çš„æ™šå¹´ç”Ÿæ´»æ™¯è±¡ï¼ˆé€šå¸¸æŒ‡48å²åŽï¼‰ã€å­å¥³æƒ…å†µã€ä¸ªäººæ·±å±‚è¿½æ±‚ã€äº‹ä¸šçš„æœ€ç»ˆæˆå°±æˆ–äººç”Ÿå½’å®¿ç­‰ã€‚

            2.  **äº”è¡ŒåŠ›é‡é€æž**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œè¯¦ç»†è¯´æ˜Žæ­¤å…«å­—å‘½å±€ä¸­é‡‘ã€æœ¨ã€æ°´ã€ç«ã€åœŸè¿™äº”ç§å…ƒç´ å„è‡ªçš„æ—ºè¡°ç¨‹åº¦ï¼ˆä¾‹å¦‚ï¼Œå“ªä¸ªäº”è¡ŒåŠ›é‡æœ€å¼ºï¼Œå“ªä¸ªç›¸å¯¹è¾ƒå¼±ï¼Œæ˜¯å¦æœ‰æŸä¸ªäº”è¡Œç¼ºå¤±ï¼‰ã€‚
                *   æŽ¥ç€ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œæ·±å…¥åˆ†æžè¿™äº›äº”è¡Œä¹‹é—´å­˜åœ¨çš„ç›¸ç”Ÿï¼ˆå¦‚æœ¨ç”Ÿç«ã€ç«ç”ŸåœŸï¼‰ä¸Žç›¸å…‹ï¼ˆå¦‚é‡‘å…‹æœ¨ã€æ°´å…‹ç«ï¼‰å…³ç³»ï¼Œæ˜¯å¦‚ä½•å…·ä½“åœ°å½±å“æ•´ä¸ªå‘½å±€çš„å¹³è¡¡çŠ¶æ€ä¸Žæ ¸å¿ƒç‰¹è´¨çš„ï¼Œè¿™äº›äº’åŠ¨åˆæ€Žæ ·å¡‘é€ äº†å‘½ä¸»çš„æ•´ä½“è¿åŠ¿èµ°å‘ã€‚

            3.  **åç¥žå…³ç³»è¯¦å¯Ÿ**ï¼š
                *   è¯·é¦–å…ˆåˆ—å‡ºæ­¤å…«å­—å››æŸ±åœ°æ”¯ä¸­æ‰€è—åŒ¿çš„å¤©å¹²ï¼ˆåŒ…æ‹¬æœ¬æ°”ã€ä¸­æ°”ã€ä½™æ°”ï¼‰ï¼Œå¹¶æ ¹æ®æ—¥ä¸»ï¼ˆæ—¥å¹²ï¼‰ï¼Œæ¸…æ™°æ ‡ç¤ºå‡ºå‘½ç›˜å¤©å¹²ä¸Šé€å‡ºçš„ä¸»è¦åç¥žï¼ˆå¦‚æ­£å®˜ã€åè´¢ã€é£Ÿç¥žã€æ¯”è‚©ç­‰ï¼‰ä»¥åŠåœ°æ”¯è—å¹²åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å¯èƒ½å¼•åŒ–å‡ºçš„åç¥žã€‚
                *   ç„¶åŽï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼ŒæŒ‘é€‰å…¶ä¸­ä¸€è‡³ä¸¤ä¸ªå¯¹å‘½å±€å½±å“æœ€ä¸ºæ˜¾è‘—çš„åç¥žï¼Œé˜è¿°å®ƒä»¬å„è‡ªä»£è¡¨çš„äººäº‹ç‰©è±¡ï¼ˆä¾‹å¦‚ï¼Œæ­£å®˜å¯èƒ½ä»£è¡¨ä¸Šå¸ã€çº¦æŸåŠ›æˆ–äº‹ä¸šï¼Œé£Ÿç¥žå¯èƒ½ä»£è¡¨æ‰åŽã€å£ç¦æˆ–æ™šè¾ˆï¼‰ï¼Œä»¥åŠå®ƒä»¬çš„å­˜åœ¨å¦‚ä½•å½±å“å‘½ä¸»çš„æ€§æ ¼ç‰¹ç‚¹å’Œäººç”Ÿé™…é‡ã€‚

            4.  **å–œç”¨ç¥žåˆæ­¥ç ”åˆ¤**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œç»¼åˆè€ƒé‡æ—¥ä¸»çš„å¼ºå¼±æ—ºè¡°ï¼ˆæ˜¯èº«å¼ºè¿˜æ˜¯èº«å¼±ï¼‰ä»¥åŠå‘½å±€ä¸­äº”è¡Œçš„æ•´ä½“å¹³è¡¡æµé€šæƒ…å†µï¼Œåˆæ­¥åˆ¤æ–­å‡ºæ­¤å‘½å±€æœ€éœ€è¦æˆ–æœ€å–œçˆ±çš„äº”è¡Œï¼ˆå³å–œç”¨ç¥žï¼‰æ˜¯ä»€ä¹ˆã€‚
                *   éšåŽï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œç®€è¦é˜è¿°æ‚¨åšå‡ºæ­¤åˆ¤æ–­çš„ä¸»è¦ä¾æ®å’Œå‘½ç†é€»è¾‘ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœæ—¥ä¸»è¿‡å¼ºï¼Œå¯èƒ½éœ€è¦å…‹åˆ¶æˆ–æ³„è€—çš„äº”è¡Œä¸ºå–œç”¨ï¼Œåä¹‹äº¦ç„¶ã€‚

            è¯·ä»¥ä¸“ä¸šä¸¥è°¨ä½†é€šä¿—æ˜“æ‡‚çš„æ–¹å¼å±•å¼€å†…å®¹ï¼Œç¡®ä¿é€»è¾‘æ¸…æ™°ã€åˆ†æžæ·±å…¥ï¼Œè®©é›¶åŸºç¡€è¯»è€…ä¹Ÿèƒ½è½»æ¾ç†è§£ã€‚
            """
        return self._call_deepseek_api(prompt)

    def generate_mingge_decode_module(self, bazi_str: str, gender: str) -> str:
        prompt = f"""
            ### å‘½æ ¼è§£ç ä¸Žäººç”Ÿç‰¹è´¨
            
            é’ˆå¯¹å…«å­—ï¼š{bazi_str}ï¼Œæ€§åˆ«ï¼š{gender}ã€‚

            **é‡è¦æç¤ºï¼š** è¯·æ‚¨åœ¨æ’°å†™æ­¤æ¨¡å—æ—¶ï¼Œé‡‡ç”¨å¨“å¨“é“æ¥çš„å™è¿°é£Žæ ¼ã€‚å¯¹äºŽä»¥ä¸‹åˆ—å‡ºçš„æ¯ä¸€ä¸ªä¸»è¦åˆ†æžç‚¹åŠå…¶å†…éƒ¨çš„å­é¡¹ï¼ˆè‹¥æœ‰ï¼‰ï¼Œè¯·ä¸è¦åªæ˜¯ç®€å•ç½—åˆ—ä¿¡æ¯ã€‚è€Œæ˜¯é’ˆå¯¹æ¯ä¸€é¡¹ï¼Œéƒ½ç”¨3åˆ°5å¥å®Œæ•´ä¸”è¿žè´¯çš„å¥å­ç»„æˆä¸€ä¸ªæµç•…çš„å°æ®µè½æ¥è¿›è¡Œæ·±å…¥æµ…å‡ºçš„é˜é‡Šã€‚æ‚¨çš„ç›®æ ‡æ˜¯è®©å³ä½¿ä¸ç†Ÿæ‚‰å…«å­—å‘½ç†çš„è¯»è€…ä¹Ÿèƒ½è½»æ¾ç†è§£å„é¡¹åˆ†æžçš„å«ä¹‰ã€é€»è¾‘åŠå…¶å¯¹å‘½ä¸»çš„å½±å“ã€‚è¯·ä¿æŒä¸“ä¸šçš„åˆ†æžæ·±åº¦ï¼ŒåŒæ—¶ç¡®ä¿è¯­è¨€é€šä¿—æ˜“æ‡‚ã€å¯Œæœ‰äº²å’ŒåŠ›ã€‚è¯·ç›´æŽ¥ä»¥è¿™æ ·çš„å™è¿°æ–¹å¼å¡«å……å„ä¸ªè¦ç‚¹ï¼Œå¹¶ä½¿ç”¨Markdownæ ¼å¼åŒ–æ‚¨çš„è¾“å‡ºã€‚
            
            è¯·è¯¦ç»†åˆ†æžä»¥ä¸‹å†…å®¹ï¼š
            
            1.  **æ ¼å±€åˆæ­¥åˆ¤æ–­ä¸Žè§£è¯»**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œå°è¯•åˆ¤æ–­æ­¤å…«å­—å¯èƒ½å±žäºŽçš„ä¸»è¦æ ¼å±€ç±»åž‹ï¼ˆä¾‹å¦‚æ‰¶æŠ‘æ ¼ä¸­çš„èº«æ—º/èº«å¼±ã€ä»Žæ ¼ä¸­çš„ä»Žå¼º/ä»Žå¼±ã€ä¸“æ—ºæ ¼ã€åŒ–æ°”æ ¼ç­‰ï¼‰ã€‚å¦‚æžœæ ¼å±€ä¸å¤Ÿå…¸åž‹æˆ–è€…å‘ˆçŽ°å¤šç§å¯èƒ½æ€§ï¼Œä¹Ÿè¯·å¦‚å®žæŒ‡å‡ºï¼Œå¹¶è¯´æ˜Žåˆ¤æ–­çš„ä¸»è¦ä¾æ®æ˜¯ä»€ä¹ˆã€‚
                *   æŽ¥ç€ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œé˜é‡Šæ­¤ï¼ˆæˆ–æ­¤ç±»ï¼‰æ ¼å±€çš„åŸºæœ¬å«ä¹‰ï¼Œä»¥åŠè¿™ç§æ ¼å±€é€šå¸¸ä¼šå¯¹å‘½ä¸»çš„äººç”Ÿå±‚æ¬¡ã€è¡Œäº‹é£Žæ ¼ä»¥åŠæˆå°±é«˜ä½Žå¸¦æ¥å“ªäº›æ–¹é¢çš„ä¸»è¦å½±å“ã€‚

            2.  **æ€§æ ¼ç‰¹è´¨æ·±åº¦æç»˜**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œèžåˆå¯¹æ—¥ä¸»å¼ºå¼±ã€åç¥žç»„åˆç‰¹ç‚¹ä»¥åŠäº”è¡Œæ—ºè¡°æƒ…å†µçš„ç»¼åˆåˆ†æžï¼Œç”ŸåŠ¨åœ°æç»˜å‡ºå‘½ä¸»åœ¨æ€§æ ¼ä¸Šå¯èƒ½å±•çŽ°çš„ä¸»è¦ä¼˜ç‚¹ï¼Œä¾‹å¦‚ç§¯æžè¿›å–ã€æ¸©å’Œå–„è‰¯æˆ–æ˜¯å¯Œæœ‰åˆ›é€ åŠ›ç­‰ã€‚
                *   åŒæ ·ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œå®¢è§‚åœ°æŒ‡å‡ºå‘½ä¸»æ€§æ ¼ä¸­å¯èƒ½å­˜åœ¨çš„ã€éœ€è¦ç•™æ„çš„æ–¹é¢æˆ–æ½œåœ¨çš„ç¼ºç‚¹ï¼Œä¾‹å¦‚å¯èƒ½æ¯”è¾ƒå›ºæ‰§ã€å®¹æ˜“å†²åŠ¨æˆ–æ˜¯å†…å¿ƒè¾ƒä¸ºæ•æ„Ÿç­‰ã€‚
                *   å†ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œåˆ†æžå¹¶é˜è¿°å‘½ä¸»åŸºäºŽå…¶å‘½æ ¼ç‰¹è´¨ï¼Œå¯èƒ½æ‹¥æœ‰çš„ç‹¬ç‰¹å¤©èµ‹ã€æ½œåœ¨æ‰èƒ½æˆ–ç‰¹åˆ«æ“…é•¿çš„é¢†åŸŸï¼Œä¾‹å¦‚å¯èƒ½åœ¨è‰ºæœ¯ã€æŠ€æœ¯ã€ç®¡ç†æˆ–æ²Ÿé€šæ–¹é¢æœ‰è¿‡äººä¹‹å¤„ã€‚
                *   æœ€åŽï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œå…·ä½“æè¿°å‘½ä¸»åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œä¸ºäººå¤„ä¸–å¯èƒ½å±•çŽ°å‡ºçš„ä¸»è¦è¡Œä¸ºæ¨¡å¼å’Œä¸Žäººäº¤å¾€çš„é²œæ˜Žç‰¹ç‚¹ã€‚

            3.  **äººç”Ÿä¸»è¦ä¼˜åŠ¿ä¸Žæ½œåœ¨æŒ‘æˆ˜**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œä¾æ®å‘½å±€çš„æ•´ä½“ç»„åˆä¸ŽåŠ›é‡åˆ†å¸ƒï¼Œåˆ†æžå‘½ä¸»åœ¨ä¸€ç”Ÿä¸­å¯èƒ½æ›´å®¹æ˜“æŠŠæ¡æˆ–æ‹¥æœ‰çš„ä¸»è¦ä¼˜åŠ¿å’Œå‘å±•æœºé‡ï¼Œä¾‹å¦‚å¯èƒ½å®¹æ˜“èŽ·å¾—è´µäººç›¸åŠ©ã€æˆ–è€…åœ¨æŸä¸ªç‰¹å®šé¢†åŸŸæ›´å®¹æ˜“å–å¾—æˆåŠŸã€‚
                *   åŒæ—¶ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼ŒæŒ‡å‡ºå‘½ä¸»åœ¨äººç”Ÿæ—…é€”ä¸­å¯èƒ½éœ€è¦é¢å¯¹å’Œå…‹æœçš„ä¸»è¦æŒ‘æˆ˜ã€å›°æ‰°æˆ–äººç”Ÿè¯¾é¢˜ï¼Œä¾‹å¦‚å¯èƒ½åœ¨äººé™…å…³ç³»ã€å¥åº·æˆ–æ˜¯æŸä¸ªæ—¶æœŸçš„è´¢è¿æ–¹é¢éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚

            4.  **æ ¸å¿ƒä»·å€¼è§‚ä¸Žäººç”Ÿè¿½æ±‚æ´žå¯Ÿ**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼ŒåŸºäºŽå‘½å±€æ‰€åæ˜ å‡ºçš„æ·±å±‚ä¿¡æ¯ï¼Œå°è¯•æŽ¨æ–­å¹¶é˜è¿°å‘½ä¸»åœ¨å†…å¿ƒæ·±å¤„å¯èƒ½ç§‰æŒçš„æ ¸å¿ƒä»·å€¼è§‚æ˜¯ä»€ä¹ˆï¼Œä¾‹å¦‚æ˜¯æ›´çœ‹é‡æˆå°±æ„Ÿã€å®¶åº­å’Œè°ã€ç²¾ç¥žè‡ªç”±è¿˜æ˜¯ç‰©è´¨ä¿éšœã€‚
                *   æŽ¥ç€ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œè¿›ä¸€æ­¥åˆ†æžå‘½ä¸»åœ¨äººç”Ÿä¸­å¯èƒ½ä¼šåŠªåŠ›è¿½æ±‚çš„ä¸»è¦ç›®æ ‡å’Œç”Ÿæ´»ç†æƒ³æ˜¯ä»€ä¹ˆæ ·çš„ã€‚

            5. **æœ¬æ¨¡å—æ ¸å¿ƒå†…å®¹æ€»ç»“**:
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œå¯¹æœ¬æ¨¡å—ï¼ˆå‘½æ ¼è§£ç ä¸Žäººç”Ÿç‰¹è´¨ï¼‰åˆ†æžçš„å…³é”®å†…å®¹å’Œæ ¸å¿ƒæ´žè§è¿›è¡Œä¸€ä¸ªç®€æ˜Žæ‰¼è¦çš„æ€»ç»“ï¼Œå¸®åŠ©è¯»è€…å›žé¡¾å’ŒæŠŠæ¡é‡ç‚¹ã€‚
            
            è¯·ç¡®ä¿åˆ†æžæ·±åˆ»ã€å¯Œæœ‰æ´žå¯ŸåŠ›ï¼Œä¸”è¡Œæ–‡æµç•…æ˜“æ‡‚ã€‚
            """
        return self._call_deepseek_api(prompt)

    def generate_career_love_module(self, bazi_str: str, gender: str) -> str:
        prompt = f"""
            ### äº‹ä¸šè´¢å¯Œä¸Žå©šæ‹åˆ†æž
            
            é’ˆå¯¹å…«å­—ï¼š{bazi_str}ï¼Œæ€§åˆ«ï¼š{gender}ã€‚

            **é‡è¦æç¤ºï¼š** è¯·æ‚¨åœ¨æ’°å†™æ­¤æ¨¡å—æ—¶ï¼Œé‡‡ç”¨å¨“å¨“é“æ¥çš„å™è¿°é£Žæ ¼ã€‚å¯¹äºŽä»¥ä¸‹åˆ—å‡ºçš„æ¯ä¸€ä¸ªä¸»è¦åˆ†æžç‚¹åŠå…¶å†…éƒ¨çš„å­é¡¹ï¼ˆè‹¥æœ‰ï¼‰ï¼Œè¯·ä¸è¦åªæ˜¯ç®€å•ç½—åˆ—ä¿¡æ¯ã€‚è€Œæ˜¯é’ˆå¯¹æ¯ä¸€é¡¹ï¼Œéƒ½ç”¨3åˆ°5å¥å®Œæ•´ä¸”è¿žè´¯çš„å¥å­ç»„æˆä¸€ä¸ªæµç•…çš„å°æ®µè½æ¥è¿›è¡Œæ·±å…¥æµ…å‡ºçš„é˜é‡Šã€‚æ‚¨çš„ç›®æ ‡æ˜¯è®©å³ä½¿ä¸ç†Ÿæ‚‰å…«å­—å‘½ç†çš„è¯»è€…ä¹Ÿèƒ½è½»æ¾ç†è§£å„é¡¹åˆ†æžçš„å«ä¹‰ã€é€»è¾‘åŠå…¶å¯¹å‘½ä¸»çš„å½±å“ã€‚è¯·ä¿æŒä¸“ä¸šçš„åˆ†æžæ·±åº¦ï¼ŒåŒæ—¶ç¡®ä¿è¯­è¨€é€šä¿—æ˜“æ‡‚ã€å¯Œæœ‰äº²å’ŒåŠ›ã€‚è¯·ç›´æŽ¥ä»¥è¿™æ ·çš„å™è¿°æ–¹å¼å¡«å……å„ä¸ªè¦ç‚¹ï¼Œå¹¶ä½¿ç”¨Markdownæ ¼å¼åŒ–æ‚¨çš„è¾“å‡ºã€‚
            
            è¯·åˆ†åˆ«è¯¦ç»†åˆ†æžäº‹ä¸šè´¢å¯Œå’Œå©šæ‹æƒ…æ„Ÿï¼š
            
            **ä¸€ã€äº‹ä¸šè´¢å¯Œè¿ç¨‹è§£æž**
            1.  **ä¼˜åŠ¿è¡Œä¸šä¸ŽèŒä¸šæ–¹å‘æŒ‡å¼•**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œæ ¹æ®æ­¤å…«å­—çš„äº”è¡Œå–œç”¨ï¼ˆå³å‘½å±€æ‰€å–œçš„äº”è¡Œå…ƒç´ ï¼‰ä»¥åŠæ˜¾è‘—çš„åç¥žç‰¹æ€§ï¼ˆä¾‹å¦‚ï¼Œè‹¥é£Ÿä¼¤ç”Ÿè´¢æ˜Žæ˜¾ï¼Œå¯èƒ½é€‚åˆåˆ›æ„æˆ–æŠ€è‰ºæ±‚è´¢ï¼›è‹¥å®˜å°ç›¸ç”Ÿï¼Œå¯èƒ½é€‚åˆç®¡ç†æˆ–å­¦æœ¯é¢†åŸŸï¼‰ï¼Œä¸ºå‘½ä¸»å»ºè®®ä¸€äº›ç›¸å¯¹æ›´æœ‰åˆ©æˆ–æ›´å®¹æ˜“èŽ·å¾—å‘å±•çš„è¡Œä¸šé¢†åŸŸã€‚
                *   æŽ¥ç€ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œè¿›ä¸€æ­¥åˆ†æžå¹¶æŒ‡å‡ºå‘½ä¸»è¾ƒä¸ºé€‚åˆçš„èŒä¸šå‘å±•æ–¹å‘æˆ–å²—ä½ç±»åž‹ï¼Œä¾‹å¦‚æ˜¯åå‘æŠ€æœ¯ç ”å‘ã€å¸‚åœºè¥é”€ã€æ•™è‚²æ–‡åŒ–ã€è¿˜æ˜¯è‡ªä¸»ç»è¥ç­‰ï¼Œå¹¶ç®€è¿°ç†ç”±ã€‚

            2.  **äº‹ä¸šå‘å±•æ¨¡å¼ä¸Žæœºé‡å‰çž»**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œåˆ†æžå¹¶é˜è¿°å‘½ä¸»çš„å‘½æ ¼æ›´å€¾å‘äºŽå“ªç§äº‹ä¸šå‘å±•æ¨¡å¼ï¼Œä¾‹å¦‚æ˜¯æ›´é€‚åˆç‹¬ç«‹åˆ›ä¸šã€å‹‡é—¯æ–°è·¯ï¼Œè¿˜æ˜¯ä¸Žäººåˆä¼™ç»è¥ã€å…±åŒå‘å±•ï¼Œäº¦æˆ–æ˜¯åœ¨ç›¸å¯¹ç¨³å®šçš„å¤§åž‹ä¼äº‹ä¸šå•ä½ä¸­æŒ‰éƒ¨å°±ç­åœ°æ™‹å‡ã€‚
                *   åŒæ—¶ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼ŒåŸºäºŽå‘½å±€ç‰¹ç‚¹ï¼Œé¢„æµ‹å‘½ä¸»åœ¨äº‹ä¸šå‘å±•è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°çš„å…¸åž‹æœºé‡ï¼ˆä¾‹å¦‚æŸä¸ªæ—¶æœŸæ˜“å¾—ææ‹”ï¼‰å’Œéœ€è¦ç•™æ„çš„æ½œåœ¨é˜»ç¢æˆ–æŒ‘æˆ˜ï¼ˆä¾‹å¦‚æŸä¸ªé˜¶æ®µæ˜“çŠ¯å°äººï¼‰ã€‚

            3.  **è´¢å¯Œèƒ½é‡è¯„ä¼°ä¸Žæ±‚è´¢ä¹‹é“**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œè¯„ä¼°å‘½ä¸»å¤©ç”Ÿçš„è´¢å¯Œèƒ½é‡ï¼ˆä¾‹å¦‚æ­£è´¢è¿ç¨³å¥è¿˜æ˜¯åè´¢è¿çªå‡ºï¼Œæˆ–è€…è´¢åº“æƒ…å†µå¦‚ä½•ï¼‰ï¼Œå¹¶åˆ†æžå…¶åœ¨é‡‘é’±è§‚å¿µå’Œç†è´¢ä¹ æƒ¯ä¸Šå¯èƒ½è¡¨çŽ°å‡ºçš„ç‰¹ç‚¹ã€‚
                *   éšåŽï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œä¸ºå‘½ä¸»æä¾›ä¸€äº›ç¬¦åˆå…¶å‘½æ ¼ç‰¹æ€§çš„æ±‚è´¢å»ºè®®å’Œç§¯ç´¯è´¢å¯Œçš„ç­–ç•¥æ–¹å‘ï¼Œä¾‹å¦‚æ˜¯å®œç¨³å¥æŠ•èµ„è¿˜æ˜¯å¯é€‚åº¦å†’é™©ï¼Œæ˜¯é ä¸“ä¸šæŠ€èƒ½è¿˜æ˜¯äººè„‰èµ„æºç­‰ã€‚

            4.  **äº‹ä¸šè´µäººç±»åž‹ä¸Žæç‚¹**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œåˆ†æžåœ¨å‘½ä¸»çš„äº‹ä¸šå‘å±•é“è·¯ä¸Šï¼Œæœ€æœ‰å¯èƒ½é‡åˆ°ä½•ç§ç±»åž‹çš„è´µäººï¼ˆä¾‹å¦‚ï¼Œæ˜¯å¹´é•¿çš„ä¸Šå¸ã€åŒè¾ˆçš„æœ‹å‹è¿˜æ˜¯æŸä¸ªç‰¹å®šå±žç›¸çš„äººï¼‰ï¼Œè¿™äº›è´µäººå¯èƒ½ä¼šåœ¨å“ªäº›æ–¹é¢ç»™äºˆé‡è¦çš„å¸®åŠ©æˆ–æŒ‡ç‚¹ã€‚

            **äºŒã€å©šæ‹æƒ…æ„Ÿè¿ç¨‹æŽ¢ç´¢**
            1.  **å©šæ‹è§‚å¿µå‰–æžä¸Žæ‹©å¶åå¥½**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œæ·±å…¥åˆ†æžå‘½ä¸»åœ¨å©šæ‹å…³ç³»ä¸­å¯èƒ½æŒæœ‰çš„æ ¸å¿ƒè§‚å¿µï¼Œä¾‹å¦‚æ˜¯æ›´å‘å¾€æµªæ¼«æ¿€æƒ…ã€æ³¨é‡çŽ°å®žæ¡ä»¶ã€æ¸´æœ›ç²¾ç¥žå…±é¸£è¿˜æ˜¯è¿½æ±‚å¹³æ·¡å®‰ç¨³ã€‚
                *   æŽ¥ç€ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œå…·ä½“æè¿°å‘½ä¸»åœ¨é€‰æ‹©ä¼´ä¾£æ—¶ï¼Œå†…å¿ƒæ·±å¤„å¯èƒ½ä¼šæ¯”è¾ƒçœ‹é‡å¯¹æ–¹å…·å¤‡å“ªäº›æ¡ä»¶æˆ–ç‰¹è´¨ï¼Œä¾‹å¦‚å¤–è²Œã€æ‰åŽã€ç»æµŽå®žåŠ›ã€æ€§æ ¼ç›¸æŠ•æˆ–æ˜¯å®¶åº­èƒŒæ™¯ç­‰ã€‚

            2.  **æƒ…æ„Ÿäº’åŠ¨æ¨¡å¼ä¸Žæ²Ÿé€šç‰¹ç‚¹**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œæç»˜å‘½ä¸»åœ¨äº²å¯†å…³ç³»ä¸­é€šå¸¸ä¼šå±•çŽ°å‡ºçš„è¡Œä¸ºç‰¹ç‚¹å’Œæƒ…æ„Ÿè¡¨è¾¾æ–¹å¼ï¼Œä¾‹å¦‚æ˜¯ä¸»åŠ¨çƒ­æƒ…åž‹ã€æ¸©å’Œä½“è´´åž‹è¿˜æ˜¯å†…æ•›å«è“„åž‹ã€‚
                *   åŒæ—¶ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œåˆ†æžå‘½ä¸»åœ¨æƒ…æ„Ÿå…³ç³»ä¸­å¯èƒ½å­˜åœ¨çš„ä¼˜ç‚¹ï¼ˆå¦‚å¿ è¯šã€å–„è§£äººæ„ï¼‰ä»¥åŠéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ²Ÿé€šé—®é¢˜æˆ–æ½œåœ¨çš„ç›¸å¤„æ¨¡å¼æŒ‘æˆ˜ã€‚

            3.  **æœªæ¥ä¼´ä¾£ä¿¡æ¯åˆæŽ¢ (è‹¥å‘½å±€ä¿¡æ¯è¾ƒä¸ºæ˜Žæ˜¾)**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œæ ¹æ®å‘½ç›˜ä¸­çš„å¤«å¦»å®«ï¼ˆé€šå¸¸æ˜¯æ—¥æ”¯ï¼‰çš„çŠ¶æ€ä»¥åŠä»£è¡¨é…å¶çš„æ˜Ÿç¥žï¼ˆç”·å‘½çœ‹è´¢æ˜Ÿï¼Œå¥³å‘½çœ‹å®˜æ€æ˜Ÿï¼‰çš„æ—ºè¡°å–œå¿Œç­‰ä¿¡æ¯ï¼Œåˆæ­¥æŽ¨æ–­æœªæ¥ä¼´ä¾£å¯èƒ½å…·å¤‡çš„æŸäº›è¾ƒä¸ºæ˜Žæ˜¾çš„ç‰¹å¾ï¼ˆå¦‚å¤§è‡´çš„æ€§æ ¼å€¾å‘ã€èƒ½åŠ›èŒƒå›´ã€å¤–å½¢æ„Ÿè§‰ç­‰ï¼‰ï¼Œæˆ–å¯èƒ½çš„ç›¸è¯†é€”å¾„ä¸Žç¼˜åˆ†æ—¶æœºã€‚ ï¼ˆè‹¥ä¿¡æ¯ä¸æ˜Žæ˜¾ï¼Œå¯è¯´æ˜Žéš¾ä»¥å…·ä½“åˆ¤æ–­ï¼‰

            4.  **å©šæ‹é¡ºåˆ©åº¦è¯„ä¼°ä¸Žç»è¥å»ºè®®**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œç»¼åˆè¯„ä¼°å‘½ä¸»å©šæ‹è¿‡ç¨‹çš„å¤§è‡´é¡ºåˆ©ç¨‹åº¦ï¼Œå¹¶æŒ‡å‡ºåœ¨æ„Ÿæƒ…é“è·¯ä¸Šå¯èƒ½é‡åˆ°çš„å…¸åž‹æƒ…æ„Ÿæ³¢æŠ˜ã€è€ƒéªŒæˆ–éœ€è¦ç»è¥çš„æ–¹é¢ã€‚
                *   æœ€åŽï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œç»™å‡ºä¸€äº›å…·æœ‰é’ˆå¯¹æ€§çš„ã€æœ‰åŠ©äºŽå‘½ä¸»æ›´å¥½åœ°ç»è¥æƒ…æ„Ÿå…³ç³»ã€æå‡å©šæ‹è¿çš„å®žç”¨å»ºè®®ã€‚
            
            è¯·ç¡®ä¿åˆ†æžå…·ä½“ã€å®žç”¨ï¼Œç»“è®ºæœ‰æ®å¯å¾ªï¼Œæ–‡å­—äº²åˆ‡æ˜“æ‡‚ã€‚
            """
        return self._call_deepseek_api(prompt)

    def generate_health_advice_module(self, bazi_str: str, gender: str) -> str:
        prompt = f"""
            ### äº”è¡Œå¥åº·ä¸Žå…»ç”Ÿå»ºè®®
            
            é’ˆå¯¹å…«å­—ï¼š{bazi_str}ï¼Œæ€§åˆ«ï¼š{gender}ã€‚

            **é‡è¦æç¤ºï¼š** è¯·æ‚¨åœ¨æ’°å†™æ­¤æ¨¡å—æ—¶ï¼Œé‡‡ç”¨å¨“å¨“é“æ¥çš„å™è¿°é£Žæ ¼ã€‚å¯¹äºŽä»¥ä¸‹åˆ—å‡ºçš„æ¯ä¸€ä¸ªä¸»è¦åˆ†æžç‚¹åŠå…¶å†…éƒ¨çš„å­é¡¹ï¼ˆè‹¥æœ‰ï¼‰ï¼Œè¯·ä¸è¦åªæ˜¯ç®€å•ç½—åˆ—ä¿¡æ¯ã€‚è€Œæ˜¯é’ˆå¯¹æ¯ä¸€é¡¹ï¼Œéƒ½ç”¨3åˆ°5å¥å®Œæ•´ä¸”è¿žè´¯çš„å¥å­ç»„æˆä¸€ä¸ªæµç•…çš„å°æ®µè½æ¥è¿›è¡Œæ·±å…¥æµ…å‡ºçš„é˜é‡Šã€‚æ‚¨çš„ç›®æ ‡æ˜¯è®©å³ä½¿ä¸ç†Ÿæ‚‰å…«å­—å‘½ç†çš„è¯»è€…ä¹Ÿèƒ½è½»æ¾ç†è§£å„é¡¹åˆ†æžçš„å«ä¹‰ã€é€»è¾‘åŠå…¶å¯¹å‘½ä¸»çš„å½±å“ã€‚è¯·ä¿æŒä¸“ä¸šçš„åˆ†æžæ·±åº¦ï¼ŒåŒæ—¶ç¡®ä¿è¯­è¨€é€šä¿—æ˜“æ‡‚ã€å¯Œæœ‰äº²å’ŒåŠ›ã€‚è¯·ç›´æŽ¥ä»¥è¿™æ ·çš„å™è¿°æ–¹å¼å¡«å……å„ä¸ªè¦ç‚¹ï¼Œå¹¶ä½¿ç”¨Markdownæ ¼å¼åŒ–æ‚¨çš„è¾“å‡ºã€‚
            
            è¯·è¯¦ç»†åˆ†æžä»¥ä¸‹å†…å®¹ï¼š
            
            1.  **äº”è¡Œå¯¹åº”è„è…‘å¥åº·çŠ¶æ€åˆ†æž**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œæ ¹æ®æ­¤å…«å­—ä¸­é‡‘ã€æœ¨ã€æ°´ã€ç«ã€åœŸäº”è¡Œçš„å¼ºå¼±åˆ†å¸ƒã€ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ç”Ÿå…‹åˆ¶åŒ–å…³ç³»ï¼Œåˆæ­¥åˆ†æžä¸Žå„äº”è¡Œç›¸å¯¹åº”çš„ä¸»è¦è„è…‘ï¼ˆä¾‹å¦‚é‡‘å¯¹åº”è‚ºä¸Žå¤§è‚ ï¼Œæœ¨å¯¹åº”è‚ä¸Žèƒ†ï¼Œæ°´å¯¹åº”è‚¾ä¸Žè†€èƒ±ï¼Œç«å¯¹åº”å¿ƒä¸Žå°è‚ ï¼ŒåœŸå¯¹åº”è„¾ä¸Žèƒƒï¼‰æ½œåœ¨çš„å¥åº·çŠ¶å†µæˆ–èƒ½é‡æ°´å¹³ã€‚
                *   æŽ¥ç€ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œå…·ä½“æŒ‡å‡ºå“ªäº›è„è…‘çš„åŠŸèƒ½åœ¨æœ¬å‘½å±€ä¸­å¯èƒ½è¡¨çŽ°å¾—ç›¸å¯¹å¼ºå¥æœ‰åŠ›ï¼Œè€Œå“ªäº›è„è…‘åˆå¯èƒ½æ˜¾å¾—ç›¸å¯¹è–„å¼±ï¼Œæˆ–è€…æ›´å®¹æ˜“åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å‡ºçŽ°å¤±è¡¡æˆ–ä¸é€‚çš„é—®é¢˜ã€‚

            2.  **ä½“è´¨åŸºæœ¬ç‰¹ç‚¹ä¸Žæ˜“æ„Ÿç—…ç—‡æç¤º**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œç»¼åˆå…«å­—äº”è¡Œçš„æ•´ä½“åå‘ï¼ˆä¾‹å¦‚åå¯’ã€åçƒ­ã€åç‡¥ã€åæ¹¿ç­‰ï¼‰ï¼Œåˆ†æžå¹¶é˜è¿°å‘½ä¸»å¯èƒ½å…·æœ‰çš„åŸºæœ¬ä½“è´¨ç‰¹ç‚¹ã€‚
                *   ç„¶åŽï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œæ ¹æ®å‘½å±€ä¸­å¯èƒ½å­˜åœ¨çš„äº”è¡Œè¿‡æ—ºã€è¿‡å¼±æˆ–ä¸¥é‡å¤±è¡¡çš„æƒ…å†µï¼Œé¢„æµ‹å‘½ä¸»åœ¨ç”Ÿæ´»ä¸­éœ€è¦ç‰¹åˆ«æ³¨æ„é¢„é˜²å“ªäº›ç±»åž‹çš„ç–¾ç—…å€¾å‘æˆ–å¸¸è§çš„èº«ä½“ä¸é€‚ç—‡çŠ¶ã€‚

            3.  **ä¸ªæ€§åŒ–å…»ç”Ÿè°ƒç†æ–¹æ¡ˆå»ºè®®**ï¼š
                *   **é¥®é£Ÿè°ƒå…»**: è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œé’ˆå¯¹å‘½å±€çš„äº”è¡Œç‰¹ç‚¹ï¼ˆä¾‹å¦‚ï¼Œè‹¥æŸäº”è¡Œè¿‡å¼±åˆ™éœ€è¡¥ç›Šï¼Œè¿‡æ—ºåˆ™éœ€ç–æ³„ï¼‰ï¼Œæå‡ºä¸€äº›å…·ä½“çš„é¥®é£Ÿå®œå¿Œã€‚ä¾‹å¦‚ï¼Œå»ºè®®å¤šé£Ÿç”¨å“ªäº›äº”è¡Œå±žæ€§çš„é£Ÿç‰©æ¥è¡¥ç›Šç›¸åº”çš„è„è…‘ï¼Œæˆ–è€…é¿å…å“ªäº›é£Ÿç‰©ä»¥å…åŠ é‡å¤±è¡¡ã€‚
                *   **ä½œæ¯ä¸Žè¿åŠ¨**: è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œç»“åˆå‘½ä¸»çš„èƒ½é‡ç‰¹ç‚¹å’Œäº”è¡Œå–œå¿Œï¼Œä¸ºå…¶æŽ¨èä¸€äº›è¾ƒä¸ºé€‚åˆçš„ä½œæ¯è§„å¾‹ï¼ˆä¾‹å¦‚æ—©ç¡æ—©èµ·ï¼Œæˆ–æ ¹æ®å­£èŠ‚è°ƒæ•´ï¼‰å’Œè¿åŠ¨æ–¹å¼ï¼ˆä¾‹å¦‚æ˜¯é€‚åˆç‘œä¼½ã€å¤ªæžç­‰é™æ€è¿åŠ¨ï¼Œè¿˜æ˜¯è·‘æ­¥ã€æ¸¸æ³³ç­‰åŠ¨æ€è¿åŠ¨ï¼Œæˆ–æ˜¯éœ€è¦åŠ¨é™ç»“åˆï¼‰ã€‚
                *   **æƒ…ç»ªç–å¯¼ä¸ŽåŽ‹åŠ›ç®¡ç†**: è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œç»“åˆå‘½ä¸»çš„æ€§æ ¼ç‰¹è´¨å’Œæ½œåœ¨çš„æƒ…ç»ªæ¨¡å¼ï¼ˆä¾‹å¦‚æ˜“æ€’ã€æ˜“å¿§æ€ç­‰ï¼‰ï¼Œæå‡ºä¸€äº›æœ‰åŠ©äºŽå…¶ä¿æŒèº«å¿ƒå¹³è¡¡ã€æœ‰æ•ˆç–å¯¼è´Ÿé¢æƒ…ç»ªå’Œç¼“è§£ç”Ÿæ´»åŽ‹åŠ›çš„æ–¹æ³•å»ºè®®ã€‚

            4.  **æœ‰åˆ©æ–¹ä½é€‰æ‹©ä¸Žç”Ÿæ´»çŽ¯å¢ƒè°ƒæ•´å‚è€ƒ**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œæ ¹æ®å‘½å±€çš„äº”è¡Œå–œç”¨ç¥žï¼Œä¸ºå‘½ä¸»åœ¨é€‰æ‹©å±…ä½æ–¹ä½ã€å·¥ä½œå­¦ä¹ æ–¹ä½æ—¶æä¾›ä¸€äº›å‚è€ƒå»ºè®®ï¼ŒæŒ‡å‡ºå“ªäº›æ–¹å‘å¯èƒ½å¯¹å…¶èº«å¿ƒå¥åº·å’Œæ•´ä½“èƒ½é‡çŠ¶æ€æ›´ä¸ºæœ‰åˆ©ã€‚
                *   åŒæ—¶ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œç®€è¦æåŠåœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œå“ªäº›é¢œè‰²æˆ–çŽ¯å¢ƒå¸ƒç½®å…ƒç´ ï¼ˆä¾‹å¦‚æ ¹æ®äº”è¡Œé€‰æ‹©æ¤ç‰©ã€è£…é¥°å“ç­‰ï¼‰å¯èƒ½å¯¹å‘½ä¸»çš„å¥åº·è¿åŠ¿èµ·åˆ°ç§¯æžçš„è¾…åŠ©ä½œç”¨ã€‚
            
            è¯·ç¡®ä¿å»ºè®®å…·æœ‰é’ˆå¯¹æ€§ï¼Œå¹¶å°½å¯èƒ½ç»“åˆä¸­åŒ»äº”è¡Œç†è®ºè¿›è¡Œé˜é‡Šï¼Œä½¿å…¶æ›´å…·å‚è€ƒä»·å€¼ã€‚
            """
        return self._call_deepseek_api(prompt)

    def generate_fortune_flow_module(self, bazi_str: str, gender: str) -> str:
        prompt = f"""
            ### å¤§è¿æµå¹´è¿åŠ¿æŽ¨æ¼” (ç®€è¦è¶‹åŠ¿)

            é’ˆå¯¹å…«å­—ï¼š{bazi_str}ï¼Œæ€§åˆ«ï¼š{gender}ã€‚

            **é‡è¦æç¤ºï¼š** è¯·æ‚¨åœ¨æ’°å†™æ­¤æ¨¡å—æ—¶ï¼Œé‡‡ç”¨å¨“å¨“é“æ¥çš„å™è¿°é£Žæ ¼ã€‚å¯¹äºŽä»¥ä¸‹åˆ—å‡ºçš„æ¯ä¸€ä¸ªä¸»è¦åˆ†æžç‚¹åŠå…¶å†…éƒ¨çš„å­é¡¹ï¼ˆè‹¥æœ‰ï¼‰ï¼Œè¯·ä¸è¦åªæ˜¯ç®€å•ç½—åˆ—ä¿¡æ¯ã€‚è€Œæ˜¯é’ˆå¯¹æ¯ä¸€é¡¹ï¼Œéƒ½ç”¨3åˆ°5å¥å®Œæ•´ä¸”è¿žè´¯çš„å¥å­ç»„æˆä¸€ä¸ªæµç•…çš„å°æ®µè½æ¥è¿›è¡Œæ·±å…¥æµ…å‡ºçš„é˜é‡Šã€‚æ‚¨çš„ç›®æ ‡æ˜¯è®©å³ä½¿ä¸ç†Ÿæ‚‰å…«å­—å‘½ç†çš„è¯»è€…ä¹Ÿèƒ½è½»æ¾ç†è§£å„é¡¹åˆ†æžçš„å«ä¹‰ã€é€»è¾‘åŠå…¶å¯¹å‘½ä¸»çš„å½±å“ã€‚è¯·ä¿æŒä¸“ä¸šçš„åˆ†æžæ·±åº¦ï¼ŒåŒæ—¶ç¡®ä¿è¯­è¨€é€šä¿—æ˜“æ‡‚ã€å¯Œæœ‰äº²å’ŒåŠ›ã€‚è¯·ç›´æŽ¥ä»¥è¿™æ ·çš„å™è¿°æ–¹å¼å¡«å……å„ä¸ªè¦ç‚¹ï¼Œå¹¶ä½¿ç”¨Markdownæ ¼å¼åŒ–æ‚¨çš„è¾“å‡ºã€‚

            è¯·è¿›è¡Œç®€è¦çš„æœªæ¥è¿åŠ¿è¶‹åŠ¿åˆ†æžï¼š

            1.  **å¤§è¿èµ·æŽ’è§„åˆ™ä¸Žèµ·è¿å²æ•°è¯´æ˜Ž**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œç®€è¦è¯´æ˜Žå¤§è¿æ˜¯å¦‚ä½•æ ¹æ®å‡ºç”ŸæœˆæŸ±å’Œæ€§åˆ«ï¼ˆé˜³ç”·é˜´å¥³é¡ºè¡Œï¼Œé˜´ç”·é˜³å¥³é€†è¡Œï¼‰æ¥èµ·æŽ’çš„ï¼Œä»¥åŠæ¯ä¸€æ­¥å¤§è¿é€šå¸¸ä¸»ç®¡åå¹´çš„è¿ç¨‹ã€‚
                *   å¦‚æžœå¯èƒ½ï¼ˆé€šå¸¸éœ€è¦ç²¾ç¡®çš„èŠ‚æ°”ä¿¡æ¯ï¼Œè‹¥æ— æ³•ç²¾ç¡®è®¡ç®—ï¼Œå¯è¯´æ˜Žæ˜¯å¤§è‡´æŽ¨æ–­ï¼‰ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼ŒæŒ‡å‡ºå‘½ä¸»å¤§çº¦ä»Žå‡ å²å¼€å§‹è¿›å…¥ç¬¬ä¸€æ­¥å¤§è¿ï¼Œå¹¶è§£é‡Šè¿™ä¸ªèµ·è¿å²æ•°æ˜¯å¦‚ä½•å½±å“äººç”Ÿé˜¶æ®µåˆ’åˆ†çš„ã€‚

            2.  **æœªæ¥1-2æ­¥å¤§è¿è¶‹åŠ¿ç®€æž (æ¯æ­¥å¤§è¿10å¹´)**ï¼š
                *   å¯¹äºŽå‘½ä¸»å³å°†è¿›å…¥æˆ–æ­£åœ¨ç»åŽ†çš„ç¬¬ä¸€æ­¥ï¼ˆæˆ–ä¸‹ä¸€ä¸¤æ­¥ï¼‰å¤§è¿ï¼Œè¯·åˆ—å‡ºå…¶å¤©å¹²åœ°æ”¯ã€‚ç„¶åŽï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œåˆ†æžè¿™ç»„å¹²æ”¯æ˜¯å¦‚ä½•ä¸ŽåŽŸå‘½å±€å‘ç”Ÿä½œç”¨çš„ï¼Œä¾‹å¦‚å®ƒä¼šå¢žå¼ºæˆ–å‰Šå¼±åŽŸå±€ä¸­çš„å“ªäº›äº”è¡ŒåŠ›é‡ï¼Œæˆ–è€…å¼•åŠ¨å“ªäº›åç¥žã€‚
                *   æŽ¥ç€ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œè¿›ä¸€æ­¥é˜è¿°åœ¨è¿™ä¸€æ­¥å¤§è¿çš„åå¹´æœŸé—´ï¼Œå‘½ä¸»åœ¨äº‹ä¸šå‘å±•ã€è´¢å¯Œç§¯ç´¯ã€æ„Ÿæƒ…ç”Ÿæ´»ã€èº«ä½“å¥åº·ç­‰ä¸»è¦äººç”Ÿæ–¹é¢ï¼Œå¯èƒ½ä¼šç»åŽ†æ€Žæ ·çš„æ€»ä½“å‰å‡¶è¶‹åŠ¿ã€ç”Ÿæ´»é‡å¿ƒå˜åŒ–æˆ–é‡è¦çš„å‘å±•æœºé‡ä¸ŽæŒ‘æˆ˜ã€‚ ï¼ˆè‹¥åˆ†æžä¸¤æ­¥å¤§è¿ï¼Œè¯·åˆ†åˆ«é˜è¿°ï¼‰

            3.  **æœªæ¥3-5å¹´æµå¹´è¿åŠ¿å…³æ³¨ç‚¹æç¤º**ï¼š
                *   è¯·åˆ—å‡ºæœªæ¥3åˆ°5å¹´çš„æµå¹´å¹²æ”¯ã€‚å¯¹äºŽå…¶ä¸­æ¯ä¸€ä¸ªæµå¹´ï¼Œè¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼Œç»“åˆå½“å‰æ‰€å¤„çš„å¤§è¿çŽ¯å¢ƒï¼ŒæŒ‡å‡ºè¯¥å¹´æœ‰å“ªäº›æ–¹é¢æ˜¯å‘½ä¸»éœ€è¦ç‰¹åˆ«å…³æ³¨çš„ï¼Œä¾‹å¦‚ï¼ŒæŸä¸€å¹´å¯èƒ½ç‰¹åˆ«æœ‰åˆ©äºŽå­¦ä¸šè¿›æ­¥æˆ–äº‹ä¸šæ‹“å±•ï¼ŒæŸä¸€å¹´åˆ™éœ€å¤šåŠ æ³¨æ„äººé™…å…³ç³»è°ƒå’Œæˆ–è´¢åŠ¡ç®¡ç†ï¼Œåˆæˆ–è€…æŸä¸€å¹´å¥åº·æ–¹é¢å®¹æ˜“å‡ºçŽ°ä¸€äº›å°çŠ¶å†µç­‰ã€‚è¯·å°½é‡ç»™å‡ºå…·ä½“çš„ç”Ÿæ´»é¢†åŸŸæç¤ºã€‚

            4.  **äººç”Ÿè¿ç¨‹è¶‹å‰é¿å‡¶æ€»æ‹¬æ€§å»ºè®®**ï¼š
                *   è¯·ç”¨3-5å¥å®Œæ•´è¿žè´¯çš„è¯ï¼ŒåŸºäºŽå¯¹å‘½å±€ç‰¹ç‚¹ä»¥åŠæœªæ¥å¤§è¿æµå¹´åŸºæœ¬è¶‹åŠ¿çš„ç»¼åˆåˆ¤æ–­ï¼Œä¸ºå‘½ä¸»æä¾›ä¸€äº›åœ¨äººç”Ÿä¸åŒè¿ç¨‹èµ·ä¼é˜¶æ®µï¼Œå¦‚ä½•æ›´å¥½åœ°æŠŠæ¡å‘å±•æœºé‡ã€è§„é¿æ½œåœ¨é£Žé™©ã€ä»¥åŠè°ƒé€‚å¿ƒæ€çš„æ€»ä½“æ€§æŒ‡å¯¼åŽŸåˆ™æˆ–æ™ºæ…§é”¦å›Šã€‚

            **å£°æ˜Ž**: æ­¤å¤„æä¾›çš„åˆ†æžæ˜¯åŸºäºŽå…«å­—å‘½ç†ç†è®ºå¯¹æœªæ¥è¿åŠ¿æ‰€åšçš„ç®€è¦è¶‹åŠ¿æ€§æŽ¨æ¼”ï¼Œä¸»è¦ç”¨äºŽæä¾›ä¸€ä¸ªå®è§‚çš„å‚è€ƒæ¡†æž¶ã€‚å…·ä½“åˆ°æ¯ä¸€å¹´ç”šè‡³æ¯ä¸€æœˆçš„è¯¦ç»†è¿åŠ¿ï¼Œä¼šå—åˆ°æ›´å¤šç»†å¾®å› ç´ çš„å½±å“ï¼Œä¸”ä¸ªäººçš„ä¸»è§‚åŠªåŠ›å’Œé€‰æ‹©äº¦è‡³å…³é‡è¦ã€‚å› æ­¤ï¼Œæœ¬å†…å®¹ä»…ä¾›å‚è€ƒï¼Œä¸å®œä½œä¸ºé‡å¤§å†³ç­–çš„å”¯ä¸€ä¾æ®ã€‚
            """
        return self._call_deepseek_api(prompt)
=======
        
        data = {
            "model": model,
            "messages": [{"role": "user", "content": prompt}],
            "temperature": 0.7,
            "max_tokens": max_tokens
        }
        
        try:
            response = requests.post(self.base_url, headers=headers, json=data, timeout=90) # å¢žåŠ è¶…æ—¶è®¾ç½®
            response.raise_for_status() # æ£€æŸ¥HTTPè¯·æ±‚æ˜¯å¦æˆåŠŸ
            return response.json()["choices"][0]["message"]["content"]
        except requests.exceptions.HTTPError as e:
            if response.status_code == 401:
                raise Exception(f"APIè°ƒç”¨å¤±è´¥: æ— æ•ˆçš„APIå¯†é’¥æˆ–æƒé™ä¸è¶³ã€‚è¯·æ£€æŸ¥æ‚¨çš„DeepSeek APIå¯†é’¥ã€‚")
            elif response.status_code == 400:
                 raise Exception(f"APIè°ƒç”¨å¤±è´¥: è¯·æ±‚å‚æ•°å‚æ•°é”™è¯¯ã€‚è¯¦ç»†ä¿¡æ¯: {response.text}")
            elif response.status_code == 429:
                 raise Exception(f"APIè°ƒç”¨å¤±è´¥: è¯·æ±‚é¢‘çŽ‡è¿‡é«˜æˆ–è¶…å‡ºé…é¢ã€‚è¯·ç¨åŽé‡è¯•æˆ–æ£€æŸ¥æ‚¨çš„DeepSeekè´¦æˆ·ã€‚")
            else:
                raise Exception(f"APIè°ƒç”¨å¤±è´¥: HTTPé”™è¯¯ {response.status_code} - {response.text}")
        except requests.exceptions.ConnectionError as e:
            raise Exception(f"APIè°ƒç”¨å¤±è´¥: æ— æ³•è¿žæŽ¥åˆ°DeepSeek APIæœåŠ¡å™¨ã€‚è¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿žæŽ¥ã€‚{e}")
        except requests.exceptions.Timeout:
            raise Exception("APIè°ƒç”¨è¶…æ—¶ã€‚DeepSeek APIå“åº”æ—¶é—´è¿‡é•¿ã€‚")
        except json.JSONDecodeError:
            raise Exception(f"APIè¿”å›žçš„ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼: {response.text}")
        except KeyError:
            raise Exception(f"APIè¿”å›žçš„JSONç»“æž„ä¸ç¬¦åˆé¢„æœŸï¼Œå¯èƒ½æ²¡æœ‰'choices'æˆ–'message'å­—æ®µã€‚åŽŸå§‹å“åº”: {response.json()}")
        except Exception as e:
            raise Exception(f"è°ƒç”¨DeepSeek APIæ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: {e}")

    def generate_free_report(self, bazi_str, gender='ç”·'):
        """ç”Ÿæˆå…è´¹ç‰ˆæŠ¥å‘Šï¼Œä»…æŽ¥å—å…«å­—å­—ç¬¦ä¸²"""
        
        prompt = f"""
        è¯·æ ¹æ®ä»¥ä¸‹å…«å­—ä¿¡æ¯ç”Ÿæˆä¸€ä»½ç®€æ˜Žåˆ†æžæŠ¥å‘Šï¼š
        å…«å­—ï¼š{gender}å‘½:{bazi_str}

        è¦æ±‚ï¼š
        1. å…«å­—æŽ’ç›˜ï¼ˆæ˜¾ç¤ºå¤©å¹²åœ°æ”¯ï¼‰
        2. äº”è¡Œåˆ†å¸ƒï¼ˆä»¥æ–‡æœ¬å½¢å¼æè¿°é‡‘ã€æœ¨ã€æ°´ã€ç«ã€åœŸçš„å æ¯”å’Œæ—ºè¡°ï¼‰
        3. æ€§æ ¼ç‰¹ç‚¹ï¼ˆç®€è¦åˆ†æžï¼‰
        4. å‘½ä¸»äº”ä¸ªå¥½çš„é¢„å…†
        5. å‘½ä¸»ä¸¤ä¸ªä¸å¥½çš„é¢„å…†
        6. 1-2æ¡å®žç”¨å»ºè®®ï¼ˆå¦‚å¹¸è¿é¢œè‰²ã€æ•°å­—ç­‰ï¼‰
        
        è¯­è¨€é€šä¿—æ˜“æ‡‚ï¼Œ300å­—ä»¥å†…ï¼Œä¿æŒä¸­ç«‹å®¢è§‚ã€‚
        
        ---
        é‡è¦ï¼šè¯·ç›´æŽ¥è¾“å‡ºæŠ¥å‘Šå†…å®¹ã€‚ä¸¥æ ¼ä½¿ç”¨æ ‡å‡†çš„Markdownè¯­æ³•è¿›è¡Œæ ¼å¼åŒ–ï¼Œä¾‹å¦‚ä½¿ç”¨æ ‡é¢˜ï¼ˆ#ï¼‰ã€åˆ—è¡¨ï¼ˆ- æˆ– *ï¼‰ã€ç²—ä½“ï¼ˆ**ï¼‰ç­‰ã€‚**è¯·ä¸è¦å°†æ•´ä¸ªæŠ¥å‘Šå†…å®¹åŒ…è£¹åœ¨ä»»ä½•ä»£ç å—ä¸­ (å³ä¸è¦åœ¨æŠ¥å‘Šå¼€å¤´å’Œç»“å°¾ä½¿ç”¨ä¸‰ä¸ªåå¼•å· \`\`\`)ã€‚** æŠ¥å‘Šä¸­è‹¥æ— ä»£ç ç¤ºä¾‹ï¼Œåˆ™æ— éœ€ä½¿ç”¨åå¼•å·ã€‚
        """
        return self.call_deepseek_api(prompt, max_tokens=700)

    def generate_premium_report(self, bazi_str, gender='ç”·'):
        """ç”Ÿæˆä»˜è´¹ç‰ˆæŠ¥å‘Šï¼Œä»…æŽ¥å—å…«å­—å­—ç¬¦ä¸²"""
        
        prompt = f"""
        ä½ æ˜¯ä¸€ä½æ‹¥æœ‰20å¹´å®žæˆ˜ç»éªŒçš„å‘½ç†å­¦å®¶ï¼Œè¯·åŸºäºŽã€Œ{gender}å‘½:{bazi_str}ã€ç”Ÿæˆä¸€ä»½ä¸“ä¸šä¸”æ˜“æ‡‚çš„å…«å­—å‘½ç†æŠ¥å‘Šã€‚
        
        â–ŒæŠ¥å‘Šè¦æ±‚
        1. ä»…ä½¿ç”¨å…«å­—æŽ¨å¯¼ï¼Œä¸¥ç¦åæŽ¨å…¬åŽ†æ—¥æœŸ
        2. æ€»å­—æ•°1800-2500å­—ï¼Œåˆ†ç« èŠ‚æŽ’ç‰ˆ
        3. æ‰€æœ‰ç»“è®ºéœ€æ³¨æ˜ŽæŽ¨å¯¼é€»è¾‘ï¼ˆå¦‚ï¼š"å› æ—¥ä¸»ç”²æœ¨ç”Ÿç”³æœˆå¤±ä»¤ï¼Œæ•…..."ï¼‰
        4. ä¸“ä¸šæœ¯è¯­é¦–çŽ°æ—¶é™„å¸¦ç™½è¯è§£é‡Šï¼ˆä¾‹ï¼šæ­£å®˜=çº¦æŸåŠ›å¼ºçš„èƒ½é‡ï¼‰
        
        â–ŒæŠ¥å‘Šç»“æž„
        ã€æ ¸å¿ƒæŽ’ç›˜ã€‘ 
        â€¢ å…«å­—å±•ç¤ºï¼š{gender}å‘½:{bazi_str}ï¼ˆå«å››æŸ±å¹²æ”¯ã€è—å¹²ã€åç¥žã€çº³éŸ³ï¼‰
        â€¢ äº”è¡Œæ—ºè¡°åˆ†æžï¼šè¯·æè¿°é‡‘ã€æœ¨ã€æ°´ã€ç«ã€åœŸçš„æ—ºè¡°çŠ¶æ€å’Œç›¸äº’å…³ç³»ï¼Œä»¥åŠå¯¹å‘½å±€çš„å½±å“ã€‚
        â€¢ åœ°æ”¯è—å¹²åˆ†æžï¼šè¯·ä»¥åˆ—è¡¨æˆ–è¡¨æ ¼å½¢å¼æè¿°åœ°æ”¯æ‰€è—å¤©å¹²åŠå…¶å¯¹å‘½å±€çš„å½±å“ã€‚
        
        ã€å‘½å±€è§£ç ã€‘
        â˜… æ ¼å±€è¯„å®šï¼š
        - åˆ¤å®šæ ‡å‡†ï¼šéœ€åˆ†æžå¹¶è¯´æ˜Žå‘½ä¸»æ ¼å±€
        - å¯Œè´µå±‚æ¬¡ï¼šåˆ†å…ˆå¤©å‘½å±€æ½œåŠ›ï¼ˆ1-10åˆ†ï¼‰+åŽå¤©å…‘çŽ°æ¡ä»¶
        - å…³é”®çŸ›ç›¾ï¼šçªå‡ºå‘½å±€æœ€å¤§å†²çªç‚¹ï¼ˆå¦‚è´¢åå°/å®˜æ€æ··æ‚ï¼‰
        
        â˜… äººç”Ÿç‰¹è´¨ï¼š
        - æ€§æ ¼ä¸‰ç»´åº¦ï¼šâ‘ ä¸»æ˜Ÿç‰¹è´¨ â‘¡äº”è¡Œæ˜¾æ€§ â‘¢åœ°æ”¯æš—è—ç‰¹è´¨
        - èƒ½åŠ›åˆ†æžï¼šæè¿°æ”¿åŠ¡/å•†ä¸š/æŠ€è‰º/å­¦æœ¯/è‰ºæœ¯ç­‰æ–¹é¢çš„æ½œåŠ›å’Œå€¾å‘ã€‚
        - æ€ç»´æ¨¡å¼ï¼šå†³ç­–é£Žæ ¼ï¼ˆç†æ€§/ç›´è§‰ï¼‰ä¸Žé£Žé™©åå¥½
        
        ã€ä¸“é¡¹é¢„æµ‹ã€‘
        ðŸ”® äº‹ä¸šè½¨è¿¹ï¼š
        - é»„é‡‘é¢†åŸŸï¼šæ ¹æ®ç”¨ç¥ž+åç¥žç»„åˆæŽ¨è3ä¸ªé€‚é…è¡Œä¸š
        - è´¢å¯Œå‘¨æœŸï¼šæ¯åå¹´è´¢è¿æ›²çº¿ï¼ˆéœ€ç»“åˆå¤§è¿èµ°åŠ¿ï¼‰
        - é£Žé™©é¢„è­¦ï¼š35/42/55å²ç­‰å…³é”®å¹´é¾„èŠ‚ç‚¹æé†’
        
        ðŸ’ž å©šæ‹æŒ‡å—ï¼š
        - é…å¶ä¸‰ç»´ç”»åƒï¼šâ‘ åç¥žç‰¹å¾ â‘¡äº”è¡Œè¡¥ç›Š â‘¢åœ°æ”¯åˆå†²
        - å©šè¿æ—¶é—´çª—ï¼šçº¢é¸¾/å¤©å–œæ˜ŸåŠ¨å¹´ä»½+æµå¹´è§¦å‘æ¡ä»¶
        - ç›¸å¤„ç¦å¿Œï¼šéœ€é¿å…çš„ç”Ÿè‚–/æ—¥æŸ±ç»„åˆ
        
        ã€åŠ¨æ€è¿åŠ¿ã€‘
        ðŸ“ˆ å¤§è¿æŽ¨æ¼”ï¼š
        - å½“å‰å¤§è¿ï¼šèµ·æ­¢æ—¶é—´+å¹²æ”¯ï¼ˆä¾‹ï¼š2020-2030 ç™¸å¯ï¼‰
        - æœªæ¥åå¹´ï¼šæ¯ä¸¤å¹´ä¸ºä¸€ä¸ªåˆ†æžå•å…ƒï¼Œæ ‡æ³¨å‰ç¥žå‡¶ç…ž
        - å…³é”®è½¬æŠ˜ï¼šæ¢è¿å‰ä¸€å¹´éœ€ç‰¹åˆ«æ³¨æ„äº‹é¡¹
        
        âœ¨ 2025ä¹™å·³å¹´ï¼š
        - æµå¹´å¦è±¡ï¼šå¹´æŸ±ä¸Žå…«å­—äº’åŠ¨å…³ç³»ï¼ˆåˆ‘å†²ç ´å®³åˆï¼‰
        - æœˆåº¦æŒ‡å—ï¼šå†œåŽ†1/4/7/10æœˆé‡ç‚¹äº‹é¡¹æé†’
        - å¤ªå²é”¦å›Šï¼šå»ºè®®ä½©æˆ´/é¿å¼€çš„äº”è¡Œå…ƒç´ 
        
        â–Œè¾“å‡ºè§„èŒƒ
        1. æ¯ç« èŠ‚ä»¥ðŸ”ã€å­¦æœ¯ä¾æ®ã€‘æ”¶å°¾ï¼Œç®€æžæŽ¨å¯¼é€»è¾‘
        2. å…³é”®ç»“è®ºå‰åŠ âš ï¸ï¼ˆé£Žé™©é¡¹ï¼‰æˆ–âœ…ï¼ˆæœºé‡é¡¹ï¼‰æ ‡è¯†
        3. æ”¹è¿å»ºè®®éœ€åŒ…å«ï¼šèŒä¸š/æ–¹ä½/é¢œè‰²/é¥°å“/ç¤¾äº¤äº”ç±»
        4. æ–‡æœ«ç»Ÿä¸€æ ‡æ³¨ï¼š"ä»¥ä¸Šå†…å®¹éœ€ç»“åˆçŽ°å®žæƒ…å†µçµæ´»è°ƒæ•´"
        
        è¯·é‡‡ç”¨å­¦è€…è®ºæ–‡å¼çš„ä¸¥è°¨è¡¨è¿°ï¼ŒåŒæ—¶ä¿æŒé£Žæ°´å¸ˆæŽ¥åœ°æ°”çš„å»ºè®®é£Žæ ¼ã€‚
        ---
        
        """
        # é‡è¦ï¼šè¯·ç›´æŽ¥è¾“å‡ºæŠ¥å‘Šå†…å®¹ã€‚ä¸¥æ ¼ä½¿ç”¨æ ‡å‡†çš„Markdownè¯­æ³•è¿›è¡Œæ ¼å¼åŒ–ï¼Œç‰¹åˆ«æ˜¯ç« èŠ‚æ ‡é¢˜ã€åˆ—è¡¨ã€ç²—ä½“ç­‰ã€‚**è¯·ä¸è¦å°†æ•´ä¸ªæŠ¥å‘Šå†…å®¹åŒ…è£¹åœ¨ä»»ä½•ä»£ç å—ä¸­ (å³ä¸è¦åœ¨æŠ¥å‘Šå¼€å¤´å’Œç»“å°¾ä½¿ç”¨ä¸‰ä¸ªåå¼•å· \`\`\`)ã€‚** æŠ¥å‘Šä¸­è‹¥æ— ä»£ç ç¤ºä¾‹ï¼Œåˆ™æ— éœ€ä½¿ç”¨åå¼•å·ã€‚
        return self.call_deepseek_api(prompt, max_tokens=5000, model="deepseek-chat")
>>>>>>> 936059c1e5039781dfa58c2493bc95dd7ca44050
